<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è„‚è³ªãƒ»ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ“ Campus Nutrition Tracker</h1>
            <p class="text-purple-100">å¤§å­¦ç”Ÿã®ãŸã‚ã®æ „é¤Šç®¡ç†ã‚¢ãƒ—ãƒª - å¥åº·çš„ãªã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒ©ã‚¤ãƒ•ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
            
            <!-- ã‚«ãƒ­ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼è­¦å‘Š -->
            <div id="calorieWarning" class="hidden mt-4 mx-auto max-w-md bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg animate-pulse">
                <div class="flex items-center justify-center">
                    <span class="text-2xl mr-2">âš ï¸</span>
                    <span class="font-bold text-lg">ã‚«ãƒ­ãƒªãƒ¼æ‘‚å–ã‚ªãƒ¼ãƒãƒ¼ã§ã™ï¼</span>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š -->
        <div class="bg-white rounded-2xl card-shadow p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                <span class="mr-2">ğŸ‘¤</span>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š
            </h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ€§åˆ¥</label>
                    <select id="gender" onchange="calculateBasalMetabolism()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="male">ç”·æ€§</option>
                        <option value="female">å¥³æ€§</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¹´é½¢</label>
                    <input type="number" id="age" value="20" min="15" max="30" onchange="calculateBasalMetabolism()" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä½“é‡ (kg)</label>
                    <input type="number" id="weight" value="60" min="40" max="120" onchange="calculateBasalMetabolism()" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">èº«é•· (cm)</label>
                    <input type="number" id="height" value="170" min="140" max="200" onchange="calculateBasalMetabolism()" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
            </div>
            <div class="mt-4 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg">
                <div class="text-center">
                    <div class="text-lg font-semibold text-gray-700">1æ—¥ã®æ¨å¥¨æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼</div>
                    <div class="text-3xl font-bold text-purple-600" id="recommendedCalories">1800</div>
                    <div class="text-sm text-gray-600">kcal/æ—¥</div>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- é£Ÿäº‹å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="space-y-6">
                <!-- æœé£Ÿ -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸŒ…</span>æœé£Ÿ
                        <span class="ml-auto text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full" id="breakfastCalories">0kcal</span>
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <select id="breakfastSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                <option value="">é£Ÿå“ãƒ»é£Ÿäº‹ã‚’é¸æŠ</option>
                                <optgroup label="å®šé£Ÿãƒ»ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼">
                                    <option value="breakfast_set">æœé£Ÿã‚»ãƒƒãƒˆ (ãƒˆãƒ¼ã‚¹ãƒˆ+åµ+ã‚µãƒ©ãƒ€)</option>
                                    <option value="japanese_breakfast">å’Œæœé£Ÿ (ã”é£¯+å‘³å™Œæ±+ç„¼ãé­š)</option>
                                    <option value="pancake_set">ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­ã‚»ãƒƒãƒˆ</option>
                                </optgroup>
                                <optgroup label="å˜å“">
                                    <option value="rice">ç™½ç±³ (100g)</option>
                                    <option value="bread">é£Ÿãƒ‘ãƒ³ (1æš60g)</option>
                                    <option value="egg">åµ (1å€‹50g)</option>
                                    <option value="milk">ç‰›ä¹³ (200ml)</option>
                                    <option value="banana">ãƒãƒŠãƒŠ (1æœ¬)</option>
                                    <option value="apple">ã‚Šã‚“ã” (1å€‹)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <input type="number" id="breakfastQuantity" min="0.1" step="0.1" value="1" 
                                   class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                            <button onclick="addMeal('breakfast')" 
                                    class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2" id="breakfastList">
                        <div class="text-center text-gray-500 py-4 text-sm">ã¾ã è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                    </div>
                </div>

                <!-- æ˜¼é£Ÿ -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">â˜€ï¸</span>æ˜¼é£Ÿ
                        <span class="ml-auto text-sm bg-orange-100 text-orange-800 px-2 py-1 rounded-full" id="lunchCalories">0kcal</span>
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <select id="lunchSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                <option value="">é£Ÿå“ãƒ»é£Ÿäº‹ã‚’é¸æŠ</option>
                                <optgroup label="å®šé£Ÿãƒ»ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼">
                                    <option value="karaage_set">å”æšã’å®šé£Ÿ</option>
                                    <option value="grilled_fish_set">ç„¼ãé­šå®šé£Ÿ</option>
                                    <option value="hamburger_set">ãƒãƒ³ãƒãƒ¼ã‚°å®šé£Ÿ</option>
                                    <option value="curry_rice">ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹</option>
                                    <option value="ramen_set">ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚»ãƒƒãƒˆ</option>
                                </optgroup>
                                <optgroup label="å˜å“">
                                    <option value="rice">ç™½ç±³ (100g)</option>
                                    <option value="chicken">é¶èƒ¸è‚‰ (100g)</option>
                                    <option value="beef">ç‰›è‚‰ (100g)</option>
                                    <option value="pork">è±šè‚‰ (100g)</option>
                                    <option value="fish">é®­ (100g)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <input type="number" id="lunchQuantity" min="0.1" step="0.1" value="1" 
                                   class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            <button onclick="addMeal('lunch')" 
                                    class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2" id="lunchList">
                        <div class="text-center text-gray-500 py-4 text-sm">ã¾ã è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                    </div>
                </div>

                <!-- å¤•é£Ÿ -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸŒ™</span>å¤•é£Ÿ
                        <span class="ml-auto text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full" id="dinnerCalories">0kcal</span>
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <select id="dinnerSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">é£Ÿå“ãƒ»é£Ÿäº‹ã‚’é¸æŠ</option>
                                <optgroup label="å®šé£Ÿãƒ»ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼">
                                    <option value="steak_set">ã‚¹ãƒ†ãƒ¼ã‚­å®šé£Ÿ</option>
                                    <option value="sashimi_set">åˆºèº«å®šé£Ÿ</option>
                                    <option value="tonkatsu_set">ã¨ã‚“ã‹ã¤å®šé£Ÿ</option>
                                    <option value="pasta_set">ãƒ‘ã‚¹ã‚¿ã‚»ãƒƒãƒˆ</option>
                                    <option value="pizza_set">ãƒ”ã‚¶ã‚»ãƒƒãƒˆ</option>
                                </optgroup>
                                <optgroup label="å˜å“">
                                    <option value="rice">ç™½ç±³ (100g)</option>
                                    <option value="chicken">é¶èƒ¸è‚‰ (100g)</option>
                                    <option value="beef">ç‰›è‚‰ (100g)</option>
                                    <option value="pork">è±šè‚‰ (100g)</option>
                                    <option value="fish">é®­ (100g)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <input type="number" id="dinnerQuantity" min="0.1" step="0.1" value="1" 
                                   class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button onclick="addMeal('dinner')" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2" id="dinnerList">
                        <div class="text-center text-gray-500 py-4 text-sm">ã¾ã è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                    </div>
                </div>

                <!-- é–“é£Ÿ -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸª</span>é–“é£Ÿ
                        <span class="ml-auto text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded-full" id="snackCalories">0kcal</span>
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <select id="snackSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">é£Ÿå“ãƒ»é£Ÿäº‹ã‚’é¸æŠ</option>
                                <optgroup label="ãŠè“å­ãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆ">
                                    <option value="cake_slice">ã‚±ãƒ¼ã‚­ (1åˆ‡ã‚Œ)</option>
                                    <option value="ice_cream">ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ  (1å€‹)</option>
                                    <option value="chocolate">ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ (50g)</option>
                                    <option value="cookies">ã‚¯ãƒƒã‚­ãƒ¼ (5æš)</option>
                                </optgroup>
                                <optgroup label="å˜å“">
                                    <option value="nuts">ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ (30g)</option>
                                    <option value="banana">ãƒãƒŠãƒŠ (1æœ¬)</option>
                                    <option value="apple">ã‚Šã‚“ã” (1å€‹)</option>
                                    <option value="cheese">ãƒãƒ¼ã‚º (20g)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <input type="number" id="snackQuantity" min="0.1" step="0.1" value="1" 
                                   class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <button onclick="addMeal('snack')" 
                                    class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2" id="snackList">
                        <div class="text-center text-gray-500 py-4 text-sm">ã¾ã è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                    </div>
                </div>
            </div>

            <!-- ä»Šæ—¥ã®æ‘‚å–é‡ -->
            <div class="bg-white rounded-2xl card-shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <span class="mr-2">ğŸ“Š</span>ä»Šæ—¥ã®æ‘‚å–é‡
                </h2>
                
                <!-- åˆè¨ˆè¡¨ç¤ºã¨é€²æ— -->
                <div class="space-y-4 mb-6">
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" id="totalCalories">0</div>
                                <div class="text-sm text-gray-600">ã‚«ãƒ­ãƒªãƒ¼ (kcal)</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600" id="totalFat">0.0</div>
                                <div class="text-sm text-gray-600">è„‚è³ª (g)</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ã‚«ãƒ­ãƒªãƒ¼é€²æ—ãƒãƒ¼ -->
                    <div class="bg-gray-100 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">ã‚«ãƒ­ãƒªãƒ¼é”æˆç‡</span>
                            <span class="text-sm font-bold text-purple-600" id="caloriePercentage">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-300" 
                                 id="calorieProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- é£Ÿå“ãƒªã‚¹ãƒˆ -->
                <div class="space-y-3" id="foodList">
                </div>

                <div class="flex gap-2 mt-4">
                    <button onclick="saveToHistory()" 
                            class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        ğŸ“… è¨˜éŒ²ä¿å­˜
                    </button>
                    <button onclick="clearAll()" 
                            class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                    </button>
                </div>
                
                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜ãƒœã‚¿ãƒ³ -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <button onclick="saveProfile()" 
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 mb-2">
                        ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜
                    </button>
                    <button onclick="loadProfile()" 
                            class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        ğŸ“‚ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
                    </button>
                </div>
            </div>

            <!-- é€±é–“ã‚°ãƒ©ãƒ• -->
            <div class="bg-white rounded-2xl card-shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <span class="mr-2">ğŸ“ˆ</span>é€±é–“ã‚«ãƒ­ãƒªãƒ¼æ¨ç§»
                </h2>
                <div class="h-64">
                    <canvas id="weeklyChart"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="clearHistory()" 
                            class="text-sm text-gray-500 hover:text-red-500 transition duration-200">
                        å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>
        </div>

        <!-- å¤§å­¦ç”Ÿå‘ã‘æ „é¤ŠTips -->
        <div class="mt-8 bg-white rounded-2xl card-shadow p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ’¡ å¤§å­¦ç”Ÿã®æ „é¤Šç®¡ç†Tips</h3>
            <div class="grid md:grid-cols-3 gap-6 text-sm">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸš ãƒãƒ©ãƒ³ã‚¹è‰¯ã„é£Ÿäº‹</h4>
                    <p class="text-blue-700">ä¸»é£Ÿãƒ»ä¸»èœãƒ»å‰¯èœã‚’æ„è­˜ã—ã¦ã€1æ—¥3é£Ÿè¦å‰‡æ­£ã—ãæ‘‚å–ã—ã¾ã—ã‚‡ã†ã€‚</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">ğŸ’ª é‹å‹•ã¨ã®çµ„ã¿åˆã‚ã›</h4>
                    <p class="text-green-700">é©åº¦ãªé‹å‹•ã¨åˆã‚ã›ã‚‹ã“ã¨ã§ã€å¥åº·çš„ãªä½“é‡ç®¡ç†ãŒã§ãã¾ã™ã€‚</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg">
                    <h4 class="font-semibold text-purple-800 mb-2">ğŸ“± è¨˜éŒ²ã®ç¿’æ…£åŒ–</h4>
                    <p class="text-purple-700">æ¯æ—¥ã®è¨˜éŒ²ã§é£Ÿç”Ÿæ´»ã‚’è¦‹ç›´ã—ã€å¥åº·æ„è­˜ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é£Ÿå“ãƒ»é£Ÿäº‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const foodDatabase = {
            // å˜å“é£Ÿå“
            rice: { name: 'ç™½ç±³', calories: 168, fat: 0.3, unit: '100g' },
            bread: { name: 'é£Ÿãƒ‘ãƒ³', calories: 158, fat: 2.6, unit: '1æš(60g)' },
            chicken: { name: 'é¶èƒ¸è‚‰', calories: 108, fat: 1.5, unit: '100g' },
            beef: { name: 'ç‰›è‚‰', calories: 250, fat: 17.1, unit: '100g' },
            pork: { name: 'è±šè‚‰', calories: 263, fat: 19.2, unit: '100g' },
            fish: { name: 'é®­', calories: 138, fat: 4.1, unit: '100g' },
            egg: { name: 'åµ', calories: 76, fat: 5.2, unit: '1å€‹(50g)' },
            milk: { name: 'ç‰›ä¹³', calories: 134, fat: 7.6, unit: '200ml' },
            cheese: { name: 'ãƒãƒ¼ã‚º', calories: 68, fat: 5.2, unit: '20g' },
            butter: { name: 'ãƒã‚¿ãƒ¼', calories: 75, fat: 8.3, unit: '10g' },
            oil: { name: 'ã‚µãƒ©ãƒ€æ²¹', calories: 111, fat: 12, unit: 'å¤§ã•ã˜1' },
            avocado: { name: 'ã‚¢ãƒœã‚«ãƒ‰', calories: 187, fat: 18.7, unit: '1å€‹' },
            nuts: { name: 'ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰', calories: 179, fat: 15.4, unit: '30g' },
            banana: { name: 'ãƒãƒŠãƒŠ', calories: 86, fat: 0.2, unit: '1æœ¬' },
            apple: { name: 'ã‚Šã‚“ã”', calories: 84, fat: 0.3, unit: '1å€‹' },
            
            // æœé£Ÿã‚»ãƒƒãƒˆ
            breakfast_set: { name: 'æœé£Ÿã‚»ãƒƒãƒˆ', calories: 420, fat: 18.5, unit: '1ã‚»ãƒƒãƒˆ' },
            japanese_breakfast: { name: 'å’Œæœé£Ÿ', calories: 380, fat: 8.2, unit: '1ã‚»ãƒƒãƒˆ' },
            pancake_set: { name: 'ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­ã‚»ãƒƒãƒˆ', calories: 520, fat: 22.3, unit: '1ã‚»ãƒƒãƒˆ' },
            
            // æ˜¼é£Ÿã‚»ãƒƒãƒˆ
            karaage_set: { name: 'å”æšã’å®šé£Ÿ', calories: 780, fat: 28.5, unit: '1ã‚»ãƒƒãƒˆ' },
            grilled_fish_set: { name: 'ç„¼ãé­šå®šé£Ÿ', calories: 650, fat: 18.2, unit: '1ã‚»ãƒƒãƒˆ' },
            hamburger_set: { name: 'ãƒãƒ³ãƒãƒ¼ã‚°å®šé£Ÿ', calories: 820, fat: 35.4, unit: '1ã‚»ãƒƒãƒˆ' },
            curry_rice: { name: 'ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹', calories: 720, fat: 22.1, unit: '1çš¿' },
            ramen_set: { name: 'ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚»ãƒƒãƒˆ', calories: 680, fat: 25.8, unit: '1ã‚»ãƒƒãƒˆ' },
            
            // å¤•é£Ÿã‚»ãƒƒãƒˆ
            steak_set: { name: 'ã‚¹ãƒ†ãƒ¼ã‚­å®šé£Ÿ', calories: 950, fat: 42.3, unit: '1ã‚»ãƒƒãƒˆ' },
            sashimi_set: { name: 'åˆºèº«å®šé£Ÿ', calories: 580, fat: 12.5, unit: '1ã‚»ãƒƒãƒˆ' },
            tonkatsu_set: { name: 'ã¨ã‚“ã‹ã¤å®šé£Ÿ', calories: 890, fat: 38.7, unit: '1ã‚»ãƒƒãƒˆ' },
            pasta_set: { name: 'ãƒ‘ã‚¹ã‚¿ã‚»ãƒƒãƒˆ', calories: 620, fat: 18.9, unit: '1ã‚»ãƒƒãƒˆ' },
            pizza_set: { name: 'ãƒ”ã‚¶ã‚»ãƒƒãƒˆ', calories: 750, fat: 28.4, unit: '1ã‚»ãƒƒãƒˆ' },
            
            // é–“é£Ÿãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆ
            cake_slice: { name: 'ã‚±ãƒ¼ã‚­', calories: 320, fat: 18.2, unit: '1åˆ‡ã‚Œ' },
            ice_cream: { name: 'ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ', calories: 180, fat: 9.5, unit: '1å€‹' },
            chocolate: { name: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', calories: 280, fat: 16.8, unit: '50g' },
            cookies: { name: 'ã‚¯ãƒƒã‚­ãƒ¼', calories: 240, fat: 12.5, unit: '5æš' }
        };

        let mealData = {
            breakfast: [],
            lunch: [],
            dinner: [],
            snack: []
        };
        let weeklyChart = null;
        let recommendedCalories = 1800;

        // åŸºç¤ä»£è¬è¨ˆç®—ï¼ˆHarris-Benedictå¼ï¼‰
        function calculateBasalMetabolism() {
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            let bmr;
            if (gender === 'male') {
                bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }

            // æ´»å‹•ãƒ¬ãƒ™ãƒ«ï¼ˆè»½åº¦æ´»å‹•ï¼š1.375ï¼‰ã‚’è€ƒæ…®
            recommendedCalories = Math.round(bmr * 1.375);
            document.getElementById('recommendedCalories').textContent = recommendedCalories;
            updateDisplay();
        }

        // å±¥æ­´ç®¡ç†
        function getCalorieHistory() {
            const history = localStorage.getItem('calorieHistory');
            return history ? JSON.parse(history) : {};
        }

        function saveToHistory() {
            const allItems = [...mealData.breakfast, ...mealData.lunch, ...mealData.dinner, ...mealData.snack];
            if (allItems.length === 0) {
                alert('è¨˜éŒ²ã™ã‚‹é£Ÿå“ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const totalCal = allItems.reduce((sum, item) => sum + item.calories, 0);
            
            const history = getCalorieHistory();
            history[today] = totalCal;
            
            localStorage.setItem('calorieHistory', JSON.stringify(history));
            
            alert(`ä»Šæ—¥ã®ã‚«ãƒ­ãƒªãƒ¼ï¼ˆ${totalCal}kcalï¼‰ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼`);
            updateChart();
        }

        function clearHistory() {
            if (confirm('å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('calorieHistory');
                updateChart();
            }
        }

        // ã‚°ãƒ©ãƒ•æ›´æ–°
        function updateChart() {
            const history = getCalorieHistory();
            const dates = [];
            const calories = [];
            const recommended = [];

            // éå»7æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const displayDate = `${date.getMonth() + 1}/${date.getDate()}`;
                
                dates.push(displayDate);
                calories.push(history[dateStr] || 0);
                recommended.push(recommendedCalories);
            }

            if (weeklyChart) {
                weeklyChart.destroy();
            }

            const ctx = document.getElementById('weeklyChart').getContext('2d');
            weeklyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼',
                        data: calories,
                        borderColor: 'rgb(147, 51, 234)',
                        backgroundColor: 'rgba(147, 51, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'æ¨å¥¨ã‚«ãƒ­ãƒªãƒ¼',
                        data: recommended,
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'transparent',
                        borderDash: [5, 5],
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ã‚«ãƒ­ãƒªãƒ¼ (kcal)'
                            }
                        }
                    }
                }
            });
        }

        function addMeal(mealType) {
            const selectId = mealType + 'Select';
            const quantityId = mealType + 'Quantity';
            
            const foodSelect = document.getElementById(selectId);
            const quantity = parseFloat(document.getElementById(quantityId).value);
            
            if (!foodSelect.value || !quantity || quantity <= 0) {
                alert('é£Ÿå“ã¨æ•°é‡ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const food = foodDatabase[foodSelect.value];
            const calories = Math.round(food.calories * quantity);
            const fat = Math.round(food.fat * quantity * 10) / 10;

            const item = {
                id: Date.now(),
                name: food.name,
                unit: food.unit,
                quantity: quantity,
                calories: calories,
                fat: fat
            };

            mealData[mealType].push(item);
            updateDisplay();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            foodSelect.value = '';
            document.getElementById(quantityId).value = '1';
        }

        function removeMealItem(mealType, id) {
            mealData[mealType] = mealData[mealType].filter(item => item.id !== id);
            updateDisplay();
        }

        function clearAll() {
            const totalItems = Object.values(mealData).reduce((sum, meals) => sum + meals.length, 0);
            if (totalItems > 0 && confirm('ä»Šæ—¥ã®é£Ÿäº‹è¨˜éŒ²ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                mealData = {
                    breakfast: [],
                    lunch: [],
                    dinner: [],
                    snack: []
                };
                updateDisplay();
            }
        }

        function updateDisplay() {
            // å„é£Ÿäº‹æ™‚é–“å¸¯ã®è¡¨ç¤ºã‚’æ›´æ–°
            updateMealDisplay('breakfast', 'yellow');
            updateMealDisplay('lunch', 'orange');
            updateMealDisplay('dinner', 'blue');
            updateMealDisplay('snack', 'purple');

            // å…¨ä½“ã®åˆè¨ˆã‚’è¨ˆç®—
            const allItems = [...mealData.breakfast, ...mealData.lunch, ...mealData.dinner, ...mealData.snack];
            const totalCal = allItems.reduce((sum, item) => sum + item.calories, 0);
            const totalFatValue = allItems.reduce((sum, item) => sum + item.fat, 0);
            const percentage = Math.round((totalCal / recommendedCalories) * 100);

            // åˆè¨ˆè¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('totalCalories').textContent = totalCal;
            document.getElementById('totalFat').textContent = totalFatValue.toFixed(1);
            document.getElementById('caloriePercentage').textContent = `${percentage}%`;
            
            const calorieProgressBar = document.getElementById('calorieProgressBar');
            calorieProgressBar.style.width = `${Math.min(percentage, 100)}%`;

            // é€²æ—ãƒãƒ¼ã®è‰²ã‚’å¤‰æ›´
            if (percentage < 80) {
                calorieProgressBar.className = 'bg-gradient-to-r from-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-300';
            } else if (percentage <= 120) {
                calorieProgressBar.className = 'bg-gradient-to-r from-green-400 to-green-500 h-3 rounded-full transition-all duration-300';
            } else {
                calorieProgressBar.className = 'bg-gradient-to-r from-red-400 to-red-500 h-3 rounded-full transition-all duration-300';
            }

            // ã‚«ãƒ­ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼è­¦å‘Šã®è¡¨ç¤º/éè¡¨ç¤º
            const calorieWarning = document.getElementById('calorieWarning');
            if (percentage > 100) {
                calorieWarning.classList.remove('hidden');
            } else {
                calorieWarning.classList.add('hidden');
            }
        }

        function updateMealDisplay(mealType, color) {
            const mealList = document.getElementById(mealType + 'List');
            const mealCalories = document.getElementById(mealType + 'Calories');
            const items = mealData[mealType];

            if (items.length === 0) {
                mealList.innerHTML = '<div class="text-center text-gray-500 py-4 text-sm">ã¾ã è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                mealCalories.textContent = '0kcal';
                return;
            }

            // é£Ÿäº‹ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            mealList.innerHTML = items.map(item => `
                <div class="flex items-center justify-between p-2 bg-${color}-50 rounded-lg border-l-4 border-${color}-400">
                    <div class="flex-1">
                        <div class="font-medium text-gray-800 text-sm">${item.name}</div>
                        <div class="text-xs text-gray-600">${item.quantity} Ã— ${item.unit}</div>
                    </div>
                    <div class="text-right mr-2">
                        <div class="text-xs font-medium text-${color}-600">${item.calories}kcal</div>
                        <div class="text-xs text-gray-500">${item.fat}gè„‚è³ª</div>
                    </div>
                    <button onclick="removeMealItem('${mealType}', ${item.id})" 
                            class="text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-50 transition duration-200 text-xs">
                        âœ•
                    </button>
                </div>
            `).join('');

            // é£Ÿäº‹æ™‚é–“å¸¯ã®åˆè¨ˆã‚«ãƒ­ãƒªãƒ¼ã‚’è¡¨ç¤º
            const mealTotal = items.reduce((sum, item) => sum + item.calories, 0);
            mealCalories.textContent = mealTotal + 'kcal';
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½
        function saveProfile() {
            const profile = {
                gender: document.getElementById('gender').value,
                age: document.getElementById('age').value,
                weight: document.getElementById('weight').value,
                height: document.getElementById('height').value,
                recommendedCalories: recommendedCalories
            };
            
            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        function loadProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (!savedProfile) {
                alert('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const profile = JSON.parse(savedProfile);
            document.getElementById('gender').value = profile.gender;
            document.getElementById('age').value = profile.age;
            document.getElementById('weight').value = profile.weight;
            document.getElementById('height').value = profile.height;
            
            calculateBasalMetabolism();
            alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
        }

        function loadSavedProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                document.getElementById('gender').value = profile.gender;
                document.getElementById('age').value = profile.age;
                document.getElementById('weight').value = profile.weight;
                document.getElementById('height').value = profile.height;
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedProfile(); // ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿
            calculateBasalMetabolism();
            updateChart();
            
            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§è¿½åŠ 
            ['breakfast', 'lunch', 'dinner', 'snack'].forEach(mealType => {
                document.getElementById(mealType + 'Quantity').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addMeal(mealType);
                    }
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971a1d2247bd19c2',t:'MTc1NTYxMTM2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
