<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水分摂取記録アプリ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #3a3d42;
            min-height: 100vh;
            padding: 40px 20px;
            color: #ffffff;
            letter-spacing: 0.05em;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 60px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #ffffff;
            margin-bottom: 20px;
        }

        .header-line {
            width: 150px;
            height: 2px;
            background: #ffffff;
            margin-bottom: 30px;
        }

        .header p {
            font-size: 1.1em;
            color: #b8bcc8;
            font-weight: 300;
            letter-spacing: 0.1em;
        }

        .settings-toggle {
            background: transparent;
            border: 1px solid #5a5f68;
            color: #ffffff;
            padding: 15px 0;
            cursor: pointer;
            font-size: 1em;
            font-weight: 300;
            margin-bottom: 40px;
            width: 100%;
            text-align: left;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .settings-toggle:hover {
            border-color: #ffffff;
        }

        .settings-section {
            margin-bottom: 40px;
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.9em;
            color: #b8bcc8;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 300;
        }

        input, select {
            background: transparent;
            border: 1px solid #5a5f68;
            color: #ffffff;
            padding: 15px 0;
            font-size: 1.1em;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ffffff;
        }

        .ideal-display {
            text-align: center;
            margin-bottom: 60px;
        }

        .ideal-label {
            font-size: 0.9em;
            color: #b8bcc8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .ideal-amount {
            font-size: 4.5em;
            color: #ffffff;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .progress-section {
            margin-bottom: 60px;
        }

        .current-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .stat-card {
            text-align: center;
            padding: 30px 0;
            border-top: 1px solid #5a5f68;
        }

        .stat-label {
            font-size: 0.9em;
            color: #b8bcc8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .stat-value {
            font-size: 3em;
            color: #ffffff;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .progress-bar {
            width: 100%;
            height: 2px;
            background: #5a5f68;
            position: relative;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: #ffffff;
            transition: width 1s ease;
            position: relative;
        }

        .progress-text {
            text-align: center;
            font-size: 1.1em;
            color: #b8bcc8;
            letter-spacing: 0.1em;
        }

        .intake-section {
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 300;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #ffffff;
            margin-bottom: 20px;
        }

        .section-line {
            width: 100px;
            height: 2px;
            background: #ffffff;
            margin-bottom: 40px;
        }

        .intake-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .intake-btn {
            background: transparent;
            border: 1px solid #5a5f68;
            color: #ffffff;
            padding: 25px 20px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 300;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            text-align: center;
        }

        .intake-btn:hover {
            border-color: #ffffff;
            background: rgba(255,255,255,0.05);
        }

        .records-section {
            margin-bottom: 60px;
        }

        .record-item {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #5a5f68;
            gap: 20px;
        }

        .record-time {
            color: #b8bcc8;
            font-size: 1em;
            letter-spacing: 0.05em;
        }

        .record-amount {
            color: #ffffff;
            font-size: 1.1em;
            letter-spacing: 0.05em;
        }

        .delete-btn {
            background: transparent;
            color: #b8bcc8;
            border: 1px solid #5a5f68;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 300;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            border-color: #ffffff;
            color: #ffffff;
        }

        .chart-container {
            margin-bottom: 60px;
        }

        .chart {
            display: flex;
            align-items: end;
            gap: 15px;
            height: 300px;
            padding: 40px 0;
            border-top: 1px solid #5a5f68;
            border-bottom: 1px solid #5a5f68;
        }

        .chart-bar {
            flex: 1;
            background: #5a5f68;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .chart-bar:hover {
            background: #ffffff;
        }

        .chart-bar.over-goal {
            background: #b8bcc8;
        }

        .chart-bar.over-goal:hover {
            background: #ffffff;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #b8bcc8;
            letter-spacing: 0.05em;
            text-align: center;
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            color: #ffffff;
            background: #3a3d42;
            padding: 5px 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            letter-spacing: 0.05em;
        }

        .chart-bar:hover .chart-bar-value {
            opacity: 1;
        }

        .over-100 {
            color: #b8bcc8 !important;
        }

        .over-100-fill {
            background: #b8bcc8 !important;
        }

        .no-records {
            text-align: center;
            color: #5a5f68;
            padding: 40px;
            font-size: 1em;
            letter-spacing: 0.05em;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .settings-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .current-stats {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .intake-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .ideal-amount {
                font-size: 3.5em;
            }

            .record-item {
                grid-template-columns: 1fr auto;
                gap: 15px;
            }

            .chart {
                height: 200px;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>水分摂取記録</h1>
            <div class="header-line"></div>
            <p>のどが乾いていなくても 水分をとりましょう</p>
        </div>

        <!-- 設定トグル -->
        <button class="settings-toggle" onclick="toggleSettings()">
                ⚙️ あなたについて（一日の理想摂取量を算出する基本情報を設定してください）
        </button>

        <!-- 基本設定（隠れる） -->
        <div class="settings-section" id="settingsSection">
            <div class="settings-row">
                <div class="form-group">
                    <label for="age">年齢</label>
                    <input type="number" id="age" min="1" max="120" value="30">
                </div>
                <div class="form-group">
                    <label for="gender">性別</label>
                    <select id="gender">
                        <option value="male">男性</option>
                        <option value="female">女性</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weight">体重 (kg)</label>
                    <input type="number" id="weight" min="30" max="200" value="60">
                </div>
            </div>
        </div>

        <!-- 理想摂取量表示 -->
        <div class="ideal-display">
            <div class="ideal-label">今日の理想摂取量</div>
            <div class="ideal-amount" id="idealAmountDisplay">2100ml</div>
        </div>

        <!-- 今日の進捗 -->
        <div class="progress-section">
            <div class="current-stats">
                <div class="stat-card">
                    <div class="stat-label">今日の摂取量</div>
                    <div class="stat-value" id="currentIntake">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">達成率</div>
                    <div class="stat-value" id="progressPercent">0%</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
        </div>

        <!-- 水分摂取ボタン -->
        <div class="intake-section">
            <h2 class="section-title">水分摂取を記録</h2>
            <div class="section-line"></div>
            <div class="intake-buttons">
                <button class="intake-btn" onclick="addIntake(50)">ひと口<br>50ml</button>
                <button class="intake-btn" onclick="addIntake(100)">コップ半分<br>100ml</button>
                <button class="intake-btn" onclick="addIntake(200)">コップ1杯<br>200ml</button>
                <button class="intake-btn" onclick="addIntake(350)">ペットボトル小<br>350ml</button>
                <button class="intake-btn" onclick="addIntake(500)">ペットボトル<br>500ml</button>
                <button class="intake-btn" onclick="addIntake(1000)">大きなボトル<br>1000ml</button>
            </div>
        </div>

        <!-- 今日の記録 -->
        <div class="records-section">
            <h2 class="section-title">今日の摂取記録</h2>
            <div class="section-line"></div>
            <div id="recordsList">
                <p class="no-records">まだ記録がありません</p>
            </div>
        </div>

        <!-- 履歴グラフ -->
        <div class="chart-container">
            <h2 class="section-title">過去7日間の摂取履歴</h2>
            <div class="section-line"></div>
            <div class="chart" id="historyChart">
                <!-- 棒グラフがここに表示されます -->
            </div>
        </div>
    </div>

    <script>
        let settings = {
            age: 30,
            gender: 'male',
            weight: 60
        };

        let todayIntake = [];
        let totalIntake = 0;
        let dailyHistory = {}; // 日別の摂取履歴

        // 履歴データの保存と読み込み
        function saveDailyHistory() {
            const historyData = JSON.stringify(dailyHistory);
            // メモリ内に保存（セッション中のみ）
        }

        function loadDailyHistory() {
            // 初期状態では空のオブジェクト
            dailyHistory = {};
        }

        // 過去7日間の日付を取得
        function getLast7Days() {
            const days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const labelStr = i === 0 ? '今日' : 
                               i === 1 ? '昨日' : 
                               `${date.getMonth() + 1}/${date.getDate()}`;
                days.push({ date: dateStr, label: labelStr });
            }
            return days;
        }

        // 履歴グラフの更新
        function updateHistoryChart() {
            const chartContainer = document.getElementById('historyChart');
            const last7Days = getLast7Days();
            const ideal = calculateIdealIntake();
            const today = new Date().toISOString().split('T')[0];
            
            // 今日のデータを履歴に保存
            dailyHistory[today] = totalIntake;
            
            const maxValue = Math.max(ideal, ...last7Days.map(day => dailyHistory[day.date] || 0));
            
            const barsHTML = last7Days.map(day => {
                const amount = dailyHistory[day.date] || 0;
                const percentage = (amount / maxValue) * 100;
                const isOverGoal = amount >= ideal;
                
                return `
                    <div class="chart-bar ${isOverGoal ? 'over-goal' : ''}" 
                         style="height: ${Math.max(percentage, 5)}%">
                        <div class="chart-bar-value">${amount}ml</div>
                        <div class="chart-bar-label">${day.label}</div>
                    </div>
                `;
            }).join('');
            
            chartContainer.innerHTML = barsHTML;
        }

        // 設定パネルの表示切替
        function toggleSettings() {
            const settingsSection = document.getElementById('settingsSection');
            const toggleBtn = document.querySelector('.settings-toggle');
            
            if (settingsSection.classList.contains('active')) {
                settingsSection.classList.remove('active');
                toggleBtn.textContent = '⚙️ あなたについて（一日の理想摂取量を算出する基本情報を設定してください）';
            } else {
                settingsSection.classList.add('active');
                toggleBtn.textContent = '✕ 自分情報を閉じる';
            }
        }

        // 理想摂取量計算（体重×35ml）
        function calculateIdealIntake() {
            return settings.weight * 35;
        }

        // 設定の保存と読み込み
        function saveSettings() {
            const settingsData = {
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                weight: parseInt(document.getElementById('weight').value)
            };
            
            settings = settingsData;
            updateIdealAmount();
            updateProgress();
        }

        function loadSettings() {
            document.getElementById('age').value = settings.age;
            document.getElementById('gender').value = settings.gender;
            document.getElementById('weight').value = settings.weight;
        }

        // 理想摂取量の更新
        function updateIdealAmount() {
            const ideal = calculateIdealIntake();
            document.getElementById('idealAmountDisplay').textContent = `${ideal}ml`;
        }

        // 進捗の更新
        function updateProgress() {
            const ideal = calculateIdealIntake();
            const percentage = (totalIntake / ideal) * 100;
            const displayPercentage = Math.round(percentage);
            
            // 統計の更新
            document.getElementById('currentIntake').textContent = `${totalIntake}ml`;
            document.getElementById('progressPercent').textContent = `${displayPercentage}%`;
            
            // プログレスバーの更新（最大表示は200%まで）
            const barPercentage = Math.min(percentage, 200);
            document.getElementById('progressFill').style.width = `${barPercentage}%`;
            document.getElementById('progressText').textContent = `${displayPercentage}%`;
            
            // 100%達成時の色変更
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const currentIntake = document.getElementById('currentIntake');
            
            if (percentage >= 100) {
                progressFill.classList.add('over-100-fill');
                progressPercent.classList.add('over-100');
                currentIntake.classList.add('over-100');
            } else {
                progressFill.classList.remove('over-100-fill');
                progressPercent.classList.remove('over-100');
                currentIntake.classList.remove('over-100');
            }
            
            // 履歴グラフも更新
            updateHistoryChart();
        }

        // 水分摂取の追加
        function addIntake(amount) {
            const now = new Date();
            const record = {
                id: Date.now(),
                amount: amount,
                time: now.toLocaleTimeString('ja-JP', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                })
            };
            
            todayIntake.push(record);
            totalIntake += amount;
            
            updateProgress();
            updateRecordsList();
            
            // アニメーション効果
            const button = event.target;
            button.style.background = 'rgba(255,255,255,0.1)';
            setTimeout(() => {
                button.style.background = 'transparent';
            }, 200);
        }

        // 記録の削除
        function deleteRecord(id) {
            const recordIndex = todayIntake.findIndex(record => record.id === id);
            if (recordIndex !== -1) {
                totalIntake -= todayIntake[recordIndex].amount;
                todayIntake.splice(recordIndex, 1);
                updateProgress();
                updateRecordsList();
            }
        }

        // 記録リストの更新（時間降順）
        function updateRecordsList() {
            const recordsList = document.getElementById('recordsList');
            
            if (todayIntake.length === 0) {
                recordsList.innerHTML = '<p class="no-records">まだ記録がありません</p>';
                return;
            }
            
            // 時間降順にソート（新しいものが先頭）
            const sortedRecords = [...todayIntake].sort((a, b) => b.id - a.id);
            
            const recordsHTML = sortedRecords.map(record => `
                <div class="record-item">
                    <span class="record-time">${record.time}</span>
                    <span class="record-amount">${record.amount}ml</span>
                    <button class="delete-btn" onclick="deleteRecord(${record.id})">削除</button>
                </div>
            `).join('');
            
            recordsList.innerHTML = recordsHTML;
        }

        // 日付チェック（新しい日になったらリセット）
        function checkNewDay() {
            const today = new Date().toISOString().split('T')[0];
            const lastDate = sessionStorage.getItem('lastDate');
            
            if (lastDate !== today) {
                // 昨日のデータを履歴に保存
                if (lastDate && totalIntake > 0) {
                    dailyHistory[lastDate] = totalIntake;
                }
                
                todayIntake = [];
                totalIntake = 0;
                sessionStorage.setItem('lastDate', today);
                updateProgress();
                updateRecordsList();
                updateHistoryChart();
            }
        }

        // イベントリスナーの設定
        document.getElementById('age').addEventListener('change', saveSettings);
        document.getElementById('gender').addEventListener('change', saveSettings);
        document.getElementById('weight').addEventListener('change', saveSettings);

        // 初期化
        function init() {
            loadDailyHistory();
            loadSettings();
            updateIdealAmount();
            updateProgress();
            updateRecordsList();
            updateHistoryChart();
            checkNewDay();
        }

        // ページ読み込み時の初期化
        window.addEventListener('load', init);

        // 定期的な日付チェック
        setInterval(checkNewDay, 60000); // 1分ごと
    </script>
</body>

<footer>&copy; 2025 Toku.</footer>

</html>