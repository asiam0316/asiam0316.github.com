<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>申請状況管理</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const ApplicationStatusManager = () => {
          const [rows, setRows] = useState([
            { id: '1', company: 'A社', device: 'モニタ', type: '払出' },
            { id: '2', company: 'B社', device: 'PC', type: '返却' }
          ]);
          
          const [columns, setColumns] = useState([
            { id: '1', name: 'step1' },
            { id: '2', name: 'step2' },
            { id: '3', name: 'step3' }
          ]);
          
          const [checkStatus, setCheckStatus] = useState({
            '1-1': { checked: true, date: '2026/1/9' },
            '1-2': { checked: true, date: '2026/1/14' },
            '2-1': { checked: true, date: '2026/1/9' }
          });

          useEffect(() => {
            const savedData = localStorage.getItem('applicationStatusData');
            if (savedData) {
              try {
                const data = JSON.parse(savedData);
                if (data.rows) setRows(data.rows);
                if (data.columns) setColumns(data.columns);
                if (data.checkStatus) setCheckStatus(data.checkStatus);
              } catch (e) {
                console.error('データの読み込みに失敗しました');
              }
            }
          }, []);

          useEffect(() => {
            const data = { rows, columns, checkStatus };
            localStorage.setItem('applicationStatusData', JSON.stringify(data));
          }, [rows, columns, checkStatus]);

          const addRow = () => {
            const newId = String(Math.max(0, ...rows.map(r => parseInt(r.id))) + 1);
            setRows([...rows, { id: newId, company: '', device: 'モニタ', type: '払出' }]);
          };

          const deleteRow = (id) => {
            setRows(rows.filter(r => r.id !== id));
            const newCheckStatus = { ...checkStatus };
            Object.keys(newCheckStatus).forEach(key => {
              if (key.startsWith(id + '-')) {
                delete newCheckStatus[key];
              }
            });
            setCheckStatus(newCheckStatus);
          };

          const updateRow = (id, field, value) => {
            setRows(rows.map(r => r.id === id ? { ...r, [field]: value } : r));
          };

          const addColumn = () => {
            const newId = String(Math.max(0, ...columns.map(c => parseInt(c.id))) + 1);
            setColumns([...columns, { id: newId, name: '' }]);
          };

          const deleteColumn = (id) => {
            setColumns(columns.filter(c => c.id !== id));
            const newCheckStatus = { ...checkStatus };
            Object.keys(newCheckStatus).forEach(key => {
              if (key.endsWith('-' + id)) {
                delete newCheckStatus[key];
              }
            });
            setCheckStatus(newCheckStatus);
          };

          const updateColumn = (id, value) => {
            setColumns(columns.map(c => c.id === id ? { ...c, name: value } : c));
          };

          const toggleCheck = (rowId, colId) => {
            const key = `${rowId}-${colId}`;
            const currentStatus = checkStatus[key];
            
            if (currentStatus?.checked) {
              const newStatus = { ...checkStatus };
              delete newStatus[key];
              setCheckStatus(newStatus);
            } else {
              const today = new Date();
              const dateStr = `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()}`;
              setCheckStatus({
                ...checkStatus,
                [key]: { checked: true, date: dateStr }
              });
            }
          };

          const exportData = () => {
            const data = { rows, columns, checkStatus };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `申請状況_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
          };

          const importData = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const data = JSON.parse(event.target.result);
                  if (data.rows) setRows(data.rows);
                  if (data.columns) setColumns(data.columns);
                  if (data.checkStatus) setCheckStatus(data.checkStatus);
                  alert('データをインポートしました');
                } catch (error) {
                  alert('ファイルの読み込みに失敗しました');
                }
              };
              reader.readAsText(file);
            }
          };

          const PlusIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          );

          const Trash2Icon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          );

          const DownloadIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          );

          const UploadIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          );

          return (
            <div className="p-6 bg-gray-200 min-h-screen">
              <div className="max-w-7xl mx-auto">
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-2xl font-bold text-gray-800">申請状況管理</h1>
                  <div className="flex gap-2">
                    <button
                      onClick={exportData}
                      className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                    >
                      <DownloadIcon />
                      エクスポート
                    </button>
                    <label className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer">
                      <UploadIcon />
                      インポート
                      <input type="file" accept=".json" onChange={importData} className="hidden" />
                    </label>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow overflow-hidden">
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse">
                      <thead>
                        <tr className="bg-blue-50">
                          <th className="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700 min-w-[200px]">
                            申請項目
                          </th>
                          <th colSpan={columns.length} className="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">
                            ステップ
                          </th>
                          <th className="border border-gray-300 px-4 py-3 w-16"></th>
                        </tr>
                        <tr className="bg-blue-50">
                          <th className="border border-gray-300 px-4 py-2"></th>
                          {columns.map(col => (
                            <th key={col.id} className="border border-gray-300 px-2 py-2 min-w-[150px]">
                              <input
                                type="text"
                                value={col.name}
                                onChange={(e) => updateColumn(col.id, e.target.value)}
                                placeholder="ステップ名"
                                className="w-full px-2 py-1 text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                              />
                            </th>
                          ))}
                          <th className="border border-gray-300 px-2 py-2">
                            <button
                              onClick={addColumn}
                              className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                              title="列を追加"
                            >
                              <PlusIcon />
                            </button>
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        {rows.map(row => (
                          <tr key={row.id} className="hover:bg-gray-50">
                            <td className="border border-gray-300 px-4 py-2">
                              <div className="flex gap-2">
                                <input
                                  type="text"
                                  value={row.company}
                                  onChange={(e) => updateRow(row.id, 'company', e.target.value)}
                                  placeholder="会社名"
                                  className="flex-1 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <select
                                  value={row.device}
                                  onChange={(e) => updateRow(row.id, 'device', e.target.value)}
                                  className="px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                  <option value="モニタ">モニタ</option>
                                  <option value="PC">PC</option>
                                </select>
                                <select
                                  value={row.type}
                                  onChange={(e) => updateRow(row.id, 'type', e.target.value)}
                                  className="px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                  <option value="払出">払出</option>
                                  <option value="返却">返却</option>
                                </select>
                              </div>
                            </td>
                            {columns.map(col => {
                              const key = `${row.id}-${col.id}`;
                              const status = checkStatus[key];
                              return (
                                <td key={col.id} className="border border-gray-300 px-2 py-2">
                                  <div className="flex items-center justify-center gap-2">
                                    <input
                                      type="checkbox"
                                      checked={status?.checked || false}
                                      onChange={() => toggleCheck(row.id, col.id)}
                                      className="w-4 h-4 cursor-pointer"
                                    />
                                    {status?.checked && (
                                      <span className="text-sm text-gray-700">{status.date}</span>
                                    )}
                                  </div>
                                </td>
                              );
                            })}
                            <td className="border border-gray-300 px-2 py-2 text-center">
                              <button
                                onClick={() => deleteRow(row.id)}
                                className="p-1 text-red-600 hover:bg-red-100 rounded"
                                title="行を削除"
                              >
                                <Trash2Icon />
                              </button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  
                  <div className="px-4 py-3 bg-gray-50 border-t border-gray-300 flex gap-2">
                    <button
                      onClick={addRow}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                    >
                      <PlusIcon />
                      行を追加
                    </button>
                    {columns.length > 0 && (
                      <button
                        onClick={() => deleteColumn(columns[columns.length - 1].id)}
                        className="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                      >
                        <Trash2Icon />
                        最後の列を削除
                      </button>
                    )}
                  </div>
                </div>

                <div className="mt-4 text-sm text-gray-600 bg-white p-4 rounded-lg shadow">
                  <p className="font-semibold mb-2">💡 使い方のヒント：</p>
                  <ul className="list-disc list-inside space-y-1">
                    <li>チェックボックスをクリックすると、その日の日付が自動的に記録されます</li>
                    <li>もう一度クリックするとチェックを外せます</li>
                    <li>データは自動的にブラウザに保存されます</li>
                    <li>他のPCで使用する場合は「エクスポート」でファイル保存し、別のPCで「インポート」してください</li>
                  </ul>
                </div>

                <div className="mt-4 text-sm text-gray-600 bg-white p-4 rounded-lg shadow">
                  <p className="font-semibold mb-2">💡 利用時の注意点：</p>
                  <ul className="list-disc list-inside space-y-1">
                    <li>本アプリは業務上の作業を個人（ローカル環境）で管理する目的での利用を想定しています。</li>
                    <li>本アプリのデータは ブラウザ内（localStorage）にのみ保存されます。</li>
                    <li>別のPC・別のブラウザではデータは共有されません。</li>
                    <li>ブラウザのデータ削除を行うと、保存内容は消えます。</li>
                    <li>ログイン機能はありません。URLを知っていれば誰でも閲覧できます。</li>
                    <li>個人情報や機密情報の入力は行わないでください。</li>
                    <li>スマホ対応していません</li>
                  </ul>
                </div>
                  
              </div>
            </div>
          );
        };

        ReactDOM.render(<ApplicationStatusManager />, document.getElementById('root'));
    </script>
</body>

</html>
